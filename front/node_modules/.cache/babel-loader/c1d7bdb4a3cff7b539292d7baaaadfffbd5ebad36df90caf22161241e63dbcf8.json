{"ast":null,"code":"/* eslint-disable prettier/prettier */import{modalStore}from'@store/modal-store';import{offsetDetailsStore}from'@store/offset-store';import{ModalTypes}from'@variables/modal-variables';import dayjs from'dayjs';export const offsetProjectPayload=async _ref=>{var _initialValue$startDa,_initialValue$expecte,_initialValue$unitCre;let{offsetId,values,initialValue,setErrors,imageFile,t}=_ref;const{updateOffset,updateProject}=offsetDetailsStore;const{projectId,shortDescription,unitCount,unitCreationYear,unitPrice,unitType,currencyId,statusId,auditUnit,name,description,address,countryId,projectStandard,startDate,circularity,expectedEndDate,unitGenerationDate,sustainableDevelopmentGoalIds}=values;const payloadProject={name:initialValue.name===name?undefined:name,description:initialValue.description===description?undefined:description,address:initialValue.address===address?undefined:address,countryId:initialValue.countryId===countryId?undefined:countryId,projectStandard:initialValue.projectStandard===projectStandard?undefined:{existingProjectStandardId:projectStandard},startDate:((_initialValue$startDa=initialValue.startDate)===null||_initialValue$startDa===void 0?void 0:_initialValue$startDa.toString())===(startDate===null||startDate===void 0?void 0:startDate.toString())?undefined:dayjs(startDate).format(),expectedEndDate:((_initialValue$expecte=initialValue.expectedEndDate)===null||_initialValue$expecte===void 0?void 0:_initialValue$expecte.toString())===(expectedEndDate===null||expectedEndDate===void 0?void 0:expectedEndDate.toString())?undefined:dayjs(expectedEndDate).format(),unitGenerationStartDate:initialValue.unitGenerationDate&&initialValue.unitGenerationDate[0].toString()===unitGenerationDate[0].toString()?undefined:dayjs(unitGenerationDate[0]).format(),unitGenerationEndDate:initialValue.unitGenerationDate&&initialValue.unitGenerationDate[1].toString()===unitGenerationDate[1].toString()?undefined:dayjs(unitGenerationDate[1]).format(),circularity:initialValue.circularity===circularity?undefined:circularity,sustainableDevelopmentGoalIds:initialValue.sustainableDevelopmentGoalIds&&initialValue.sustainableDevelopmentGoalIds.toString()===sustainableDevelopmentGoalIds.toString()?undefined:sustainableDevelopmentGoalIds,image:imageFile?{contentAsBase64:imageFile===null||imageFile===void 0?void 0:imageFile.contentAsBase64,contentType:imageFile===null||imageFile===void 0?void 0:imageFile.contentType}:undefined};const payloadOffset={shortDescription:initialValue.shortDescription===shortDescription?undefined:shortDescription,unitCount:initialValue.unitCount===unitCount?undefined:unitCount,unitCreationYear:((_initialValue$unitCre=initialValue.unitCreationYear)===null||_initialValue$unitCre===void 0?void 0:_initialValue$unitCre.toString())===(unitCreationYear===null||unitCreationYear===void 0?void 0:unitCreationYear.toString())?undefined:dayjs(unitCreationYear).format('YYYY-MM-DD'),unitPrice:initialValue.unitPrice===unitPrice?undefined:unitPrice,currencyId:initialValue.currencyId===currencyId?undefined:currencyId,unitType:initialValue.unitType===unitType?undefined:{existingOffsetUnitTypeId:unitType},auditUnit:initialValue.auditUnit===auditUnit?undefined:{existingOffsetAuditUnitId:auditUnit},statusId:initialValue.statusId===statusId?undefined:statusId};const allPayloadUndefined=payload=>Object.values(payload).find(elem=>elem!==undefined);if(allPayloadUndefined(payloadOffset)!==undefined){const response=await updateOffset(payloadOffset,offsetId);if(response.isUnsuccessful()){if(response.isValidationError())setErrors(response.validationErrors);return false;}modalStore.push({title:t('offer.updatedVerificationModalTitle'),content:t('offer.updatedVerificationModalContent'),type:ModalTypes.Info});}if(allPayloadUndefined(payloadProject)!==undefined){const response=await updateProject(payloadProject,projectId);if(response.isUnsuccessful()){if(response.isValidationError())setErrors(response.validationErrors);return false;}modalStore.push({title:t('project.edit.projectVerificationModalTitle'),content:t('project.edit.projectVerificationModalContent'),type:ModalTypes.Info});}return true;};","map":{"version":3,"names":["modalStore","offsetDetailsStore","ModalTypes","dayjs","offsetProjectPayload","_ref","_initialValue$startDa","_initialValue$expecte","_initialValue$unitCre","offsetId","values","initialValue","setErrors","imageFile","t","updateOffset","updateProject","projectId","shortDescription","unitCount","unitCreationYear","unitPrice","unitType","currencyId","statusId","auditUnit","name","description","address","countryId","projectStandard","startDate","circularity","expectedEndDate","unitGenerationDate","sustainableDevelopmentGoalIds","payloadProject","undefined","existingProjectStandardId","toString","format","unitGenerationStartDate","unitGenerationEndDate","image","contentAsBase64","contentType","payloadOffset","existingOffsetUnitTypeId","existingOffsetAuditUnitId","allPayloadUndefined","payload","Object","find","elem","response","isUnsuccessful","isValidationError","validationErrors","push","title","content","type","Info"],"sources":["/Users/st/Documents/carbon/front/src/screens/offset/offset-details/offset-project-formik/offset-project-payload.tsx"],"sourcesContent":["/* eslint-disable prettier/prettier */\nimport { ImgFileTypes } from '@custom-types/img-types';\nimport { useTranslation, UseTranslationResponse } from 'react-i18next';\nimport { OffsetFormikTypes } from '@custom-types/offset-types';\nimport { PatchResponseOffset } from '@custom-types/offsets-types';\nimport { PatchProjectPayload } from '@custom-types/projects-types';\nimport { modalStore } from '@store/modal-store';\nimport { offsetDetailsStore } from '@store/offset-store';\nimport { ModalTypes } from '@variables/modal-variables';\nimport dayjs from 'dayjs';\nimport { FormikValues } from 'formik';\n\ninterface Props {\n  offsetId: string | undefined;\n  values: FormikValues;\n  initialValue: OffsetFormikTypes;\n  setErrors: (errors: any) => void;\n  imageFile: ImgFileTypes | null;\n  t: any;\n}\n\nexport const offsetProjectPayload = async ({\n  offsetId,\n  values,\n  initialValue,\n  setErrors,\n  imageFile,\n  t,\n}: Props): Promise<boolean> => {\n  const { updateOffset, updateProject } = offsetDetailsStore;\n  const {\n    projectId,\n    shortDescription,\n    unitCount,\n    unitCreationYear,\n    unitPrice,\n    unitType,\n    currencyId,\n    statusId,\n    auditUnit,\n    name,\n    description,\n    address,\n    countryId,\n    projectStandard,\n    startDate,\n    circularity,\n    expectedEndDate,\n    unitGenerationDate,\n    sustainableDevelopmentGoalIds,\n  } = values;\n  const payloadProject: PatchProjectPayload = {\n    name: initialValue.name === name ? undefined : name,\n    description: initialValue.description === description ? undefined : description,\n    address: initialValue.address === address ? undefined : address,\n    countryId: initialValue.countryId === countryId ? undefined : countryId,\n    projectStandard:\n      initialValue.projectStandard === projectStandard\n        ? undefined\n        : {\n            existingProjectStandardId: projectStandard,\n          },\n    startDate:\n      initialValue.startDate?.toString() === startDate?.toString()\n        ? undefined\n        : dayjs(startDate).format(),\n    expectedEndDate:\n      initialValue.expectedEndDate?.toString() === expectedEndDate?.toString()\n        ? undefined\n        : dayjs(expectedEndDate).format(),\n    unitGenerationStartDate:\n      initialValue.unitGenerationDate &&\n      initialValue.unitGenerationDate[0].toString() === unitGenerationDate[0].toString()\n        ? undefined\n        : dayjs(unitGenerationDate[0]).format(),\n    unitGenerationEndDate:\n      initialValue.unitGenerationDate &&\n      initialValue.unitGenerationDate[1].toString() === unitGenerationDate[1].toString()\n        ? undefined\n        : dayjs(unitGenerationDate[1]).format(),\n    circularity: initialValue.circularity === circularity ? undefined : circularity,\n    sustainableDevelopmentGoalIds:\n      initialValue.sustainableDevelopmentGoalIds &&\n      initialValue.sustainableDevelopmentGoalIds.toString() ===\n        sustainableDevelopmentGoalIds.toString()\n        ? undefined\n        : sustainableDevelopmentGoalIds,\n    image: imageFile\n      ? {\n          contentAsBase64: imageFile?.contentAsBase64,\n          contentType: imageFile?.contentType,\n        }\n      : undefined,\n  };\n  const payloadOffset: PatchResponseOffset = {\n    shortDescription:\n      initialValue.shortDescription === shortDescription ? undefined : shortDescription,\n    unitCount: initialValue.unitCount === unitCount ? undefined : unitCount,\n    unitCreationYear:\n      initialValue.unitCreationYear?.toString() === unitCreationYear?.toString()\n        ? undefined\n        : dayjs(unitCreationYear).format('YYYY-MM-DD'),\n    unitPrice: initialValue.unitPrice === unitPrice ? undefined : unitPrice,\n    currencyId: initialValue.currencyId === currencyId ? undefined : currencyId,\n    unitType:\n      initialValue.unitType === unitType\n        ? undefined\n        : {\n            existingOffsetUnitTypeId: unitType,\n          },\n    auditUnit:\n      initialValue.auditUnit === auditUnit\n        ? undefined\n        : {\n            existingOffsetAuditUnitId: auditUnit,\n          },\n    statusId: initialValue.statusId === statusId ? undefined : statusId,\n  };\n\n  const allPayloadUndefined = (payload: PatchResponseOffset | PatchProjectPayload) =>\n    Object.values(payload).find((elem) => elem !== undefined);\n  if (allPayloadUndefined(payloadOffset) !== undefined) {\n    const response = await updateOffset(payloadOffset, offsetId);\n    if (response.isUnsuccessful()) {\n      if (response.isValidationError()) setErrors(response.validationErrors);\n      return false;\n    }\n\n    modalStore.push({\n      title: t('offer.updatedVerificationModalTitle'),\n      content: t('offer.updatedVerificationModalContent'),\n      type: ModalTypes.Info,\n    });\n  }\n\n  if (allPayloadUndefined(payloadProject) !== undefined) {\n    const response = await updateProject(payloadProject, projectId);\n    if (response.isUnsuccessful()) {\n      if (response.isValidationError()) setErrors(response.validationErrors);\n      return false;\n    }\n\n    modalStore.push({\n      title: t('project.edit.projectVerificationModalTitle'),\n      content: t('project.edit.projectVerificationModalContent'),\n      type: ModalTypes.Info,\n    });\n  }\n\n  return true;\n};\n"],"mappings":"AAAA,sCAMA,OAASA,UAAU,KAAQ,oBAAoB,CAC/C,OAASC,kBAAkB,KAAQ,qBAAqB,CACxD,OAASC,UAAU,KAAQ,4BAA4B,CACvD,MAAO,CAAAC,KAAK,KAAM,OAAO,CAYzB,MAAO,MAAM,CAAAC,oBAAoB,CAAG,MAAAC,IAAA,EAOL,KAAAC,qBAAA,CAAAC,qBAAA,CAAAC,qBAAA,IAPY,CACzCC,QAAQ,CACRC,MAAM,CACNC,YAAY,CACZC,SAAS,CACTC,SAAS,CACTC,CACK,CAAC,CAAAT,IAAA,CACN,KAAM,CAAEU,YAAY,CAAEC,aAAc,CAAC,CAAGf,kBAAkB,CAC1D,KAAM,CACJgB,SAAS,CACTC,gBAAgB,CAChBC,SAAS,CACTC,gBAAgB,CAChBC,SAAS,CACTC,QAAQ,CACRC,UAAU,CACVC,QAAQ,CACRC,SAAS,CACTC,IAAI,CACJC,WAAW,CACXC,OAAO,CACPC,SAAS,CACTC,eAAe,CACfC,SAAS,CACTC,WAAW,CACXC,eAAe,CACfC,kBAAkB,CAClBC,6BACF,CAAC,CAAGzB,MAAM,CACV,KAAM,CAAA0B,cAAmC,CAAG,CAC1CV,IAAI,CAAEf,YAAY,CAACe,IAAI,GAAKA,IAAI,CAAGW,SAAS,CAAGX,IAAI,CACnDC,WAAW,CAAEhB,YAAY,CAACgB,WAAW,GAAKA,WAAW,CAAGU,SAAS,CAAGV,WAAW,CAC/EC,OAAO,CAAEjB,YAAY,CAACiB,OAAO,GAAKA,OAAO,CAAGS,SAAS,CAAGT,OAAO,CAC/DC,SAAS,CAAElB,YAAY,CAACkB,SAAS,GAAKA,SAAS,CAAGQ,SAAS,CAAGR,SAAS,CACvEC,eAAe,CACbnB,YAAY,CAACmB,eAAe,GAAKA,eAAe,CAC5CO,SAAS,CACT,CACEC,yBAAyB,CAAER,eAC7B,CAAC,CACPC,SAAS,CACP,EAAAzB,qBAAA,CAAAK,YAAY,CAACoB,SAAS,UAAAzB,qBAAA,iBAAtBA,qBAAA,CAAwBiC,QAAQ,CAAC,CAAC,KAAKR,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAEQ,QAAQ,CAAC,CAAC,EACxDF,SAAS,CACTlC,KAAK,CAAC4B,SAAS,CAAC,CAACS,MAAM,CAAC,CAAC,CAC/BP,eAAe,CACb,EAAA1B,qBAAA,CAAAI,YAAY,CAACsB,eAAe,UAAA1B,qBAAA,iBAA5BA,qBAAA,CAA8BgC,QAAQ,CAAC,CAAC,KAAKN,eAAe,SAAfA,eAAe,iBAAfA,eAAe,CAAEM,QAAQ,CAAC,CAAC,EACpEF,SAAS,CACTlC,KAAK,CAAC8B,eAAe,CAAC,CAACO,MAAM,CAAC,CAAC,CACrCC,uBAAuB,CACrB9B,YAAY,CAACuB,kBAAkB,EAC/BvB,YAAY,CAACuB,kBAAkB,CAAC,CAAC,CAAC,CAACK,QAAQ,CAAC,CAAC,GAAKL,kBAAkB,CAAC,CAAC,CAAC,CAACK,QAAQ,CAAC,CAAC,CAC9EF,SAAS,CACTlC,KAAK,CAAC+B,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAACM,MAAM,CAAC,CAAC,CAC3CE,qBAAqB,CACnB/B,YAAY,CAACuB,kBAAkB,EAC/BvB,YAAY,CAACuB,kBAAkB,CAAC,CAAC,CAAC,CAACK,QAAQ,CAAC,CAAC,GAAKL,kBAAkB,CAAC,CAAC,CAAC,CAACK,QAAQ,CAAC,CAAC,CAC9EF,SAAS,CACTlC,KAAK,CAAC+B,kBAAkB,CAAC,CAAC,CAAC,CAAC,CAACM,MAAM,CAAC,CAAC,CAC3CR,WAAW,CAAErB,YAAY,CAACqB,WAAW,GAAKA,WAAW,CAAGK,SAAS,CAAGL,WAAW,CAC/EG,6BAA6B,CAC3BxB,YAAY,CAACwB,6BAA6B,EAC1CxB,YAAY,CAACwB,6BAA6B,CAACI,QAAQ,CAAC,CAAC,GACnDJ,6BAA6B,CAACI,QAAQ,CAAC,CAAC,CACtCF,SAAS,CACTF,6BAA6B,CACnCQ,KAAK,CAAE9B,SAAS,CACZ,CACE+B,eAAe,CAAE/B,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAE+B,eAAe,CAC3CC,WAAW,CAAEhC,SAAS,SAATA,SAAS,iBAATA,SAAS,CAAEgC,WAC1B,CAAC,CACDR,SACN,CAAC,CACD,KAAM,CAAAS,aAAkC,CAAG,CACzC5B,gBAAgB,CACdP,YAAY,CAACO,gBAAgB,GAAKA,gBAAgB,CAAGmB,SAAS,CAAGnB,gBAAgB,CACnFC,SAAS,CAAER,YAAY,CAACQ,SAAS,GAAKA,SAAS,CAAGkB,SAAS,CAAGlB,SAAS,CACvEC,gBAAgB,CACd,EAAAZ,qBAAA,CAAAG,YAAY,CAACS,gBAAgB,UAAAZ,qBAAA,iBAA7BA,qBAAA,CAA+B+B,QAAQ,CAAC,CAAC,KAAKnB,gBAAgB,SAAhBA,gBAAgB,iBAAhBA,gBAAgB,CAAEmB,QAAQ,CAAC,CAAC,EACtEF,SAAS,CACTlC,KAAK,CAACiB,gBAAgB,CAAC,CAACoB,MAAM,CAAC,YAAY,CAAC,CAClDnB,SAAS,CAAEV,YAAY,CAACU,SAAS,GAAKA,SAAS,CAAGgB,SAAS,CAAGhB,SAAS,CACvEE,UAAU,CAAEZ,YAAY,CAACY,UAAU,GAAKA,UAAU,CAAGc,SAAS,CAAGd,UAAU,CAC3ED,QAAQ,CACNX,YAAY,CAACW,QAAQ,GAAKA,QAAQ,CAC9Be,SAAS,CACT,CACEU,wBAAwB,CAAEzB,QAC5B,CAAC,CACPG,SAAS,CACPd,YAAY,CAACc,SAAS,GAAKA,SAAS,CAChCY,SAAS,CACT,CACEW,yBAAyB,CAAEvB,SAC7B,CAAC,CACPD,QAAQ,CAAEb,YAAY,CAACa,QAAQ,GAAKA,QAAQ,CAAGa,SAAS,CAAGb,QAC7D,CAAC,CAED,KAAM,CAAAyB,mBAAmB,CAAIC,OAAkD,EAC7EC,MAAM,CAACzC,MAAM,CAACwC,OAAO,CAAC,CAACE,IAAI,CAAEC,IAAI,EAAKA,IAAI,GAAKhB,SAAS,CAAC,CAC3D,GAAIY,mBAAmB,CAACH,aAAa,CAAC,GAAKT,SAAS,CAAE,CACpD,KAAM,CAAAiB,QAAQ,CAAG,KAAM,CAAAvC,YAAY,CAAC+B,aAAa,CAAErC,QAAQ,CAAC,CAC5D,GAAI6C,QAAQ,CAACC,cAAc,CAAC,CAAC,CAAE,CAC7B,GAAID,QAAQ,CAACE,iBAAiB,CAAC,CAAC,CAAE5C,SAAS,CAAC0C,QAAQ,CAACG,gBAAgB,CAAC,CACtE,MAAO,MAAK,CACd,CAEAzD,UAAU,CAAC0D,IAAI,CAAC,CACdC,KAAK,CAAE7C,CAAC,CAAC,qCAAqC,CAAC,CAC/C8C,OAAO,CAAE9C,CAAC,CAAC,uCAAuC,CAAC,CACnD+C,IAAI,CAAE3D,UAAU,CAAC4D,IACnB,CAAC,CAAC,CACJ,CAEA,GAAIb,mBAAmB,CAACb,cAAc,CAAC,GAAKC,SAAS,CAAE,CACrD,KAAM,CAAAiB,QAAQ,CAAG,KAAM,CAAAtC,aAAa,CAACoB,cAAc,CAAEnB,SAAS,CAAC,CAC/D,GAAIqC,QAAQ,CAACC,cAAc,CAAC,CAAC,CAAE,CAC7B,GAAID,QAAQ,CAACE,iBAAiB,CAAC,CAAC,CAAE5C,SAAS,CAAC0C,QAAQ,CAACG,gBAAgB,CAAC,CACtE,MAAO,MAAK,CACd,CAEAzD,UAAU,CAAC0D,IAAI,CAAC,CACdC,KAAK,CAAE7C,CAAC,CAAC,4CAA4C,CAAC,CACtD8C,OAAO,CAAE9C,CAAC,CAAC,8CAA8C,CAAC,CAC1D+C,IAAI,CAAE3D,UAAU,CAAC4D,IACnB,CAAC,CAAC,CACJ,CAEA,MAAO,KAAI,CACb,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}