{"ast":null,"code":"import{useEffect,useRef}from'react';import{observer}from'mobx-react';import{useNavigate}from'react-router-dom';import{ROUTES}from'@utils/routes';import{axiosAuthorized}from'@api/api';import userStore from'@store/user-store';export const RefreshTokenProvider=observer(_ref=>{let{children}=_ref;const refreshTokenResponseInterceptor=useRef(0);const navigate=useNavigate();const createRefreshTokenInterceptors=()=>{refreshTokenResponseInterceptor.current=axiosAuthorized.interceptors.response.use(response=>response,async error=>{if(error.response.status===401){error.response.config._retry=true;axiosAuthorized.interceptors.response.eject(refreshTokenResponseInterceptor.current);try{await axiosAuthorized.post('/auth/refresh-token');}catch(refreshTokenError){userStore.setUser(undefined);navigate(ROUTES.Login.path);throw refreshTokenError;}finally{createRefreshTokenInterceptors();}return axiosAuthorized(error.response.config);}throw error;});};useEffect(()=>{createRefreshTokenInterceptors();return()=>{axiosAuthorized.interceptors.response.eject(refreshTokenResponseInterceptor.current);};},[]);return children;});","map":{"version":3,"names":["useEffect","useRef","observer","useNavigate","ROUTES","axiosAuthorized","userStore","RefreshTokenProvider","_ref","children","refreshTokenResponseInterceptor","navigate","createRefreshTokenInterceptors","current","interceptors","response","use","error","status","config","_retry","eject","post","refreshTokenError","setUser","undefined","Login","path"],"sources":["/Users/st/Documents/carbon/front/src/components/refresh-token-provider/refresh-token-provider.tsx"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { observer } from 'mobx-react';\nimport { useNavigate } from 'react-router-dom';\nimport { ROUTES } from '@utils/routes';\nimport { axiosAuthorized } from '@api/api';\nimport userStore from '@store/user-store';\n\ninterface RefreshTokenProviderProps {\n  children: JSX.Element;\n}\n\nexport const RefreshTokenProvider = observer(({ children }: RefreshTokenProviderProps) => {\n  const refreshTokenResponseInterceptor = useRef(0);\n  const navigate = useNavigate();\n\n  const createRefreshTokenInterceptors = () => {\n    refreshTokenResponseInterceptor.current = axiosAuthorized.interceptors.response.use(\n      (response) => response,\n      async (error) => {\n        if (error.response.status === 401) {\n          error.response.config._retry = true;\n          axiosAuthorized.interceptors.response.eject(refreshTokenResponseInterceptor.current);\n\n          try {\n            await axiosAuthorized.post('/auth/refresh-token');\n          } catch (refreshTokenError) {\n            userStore.setUser(undefined);\n            navigate(ROUTES.Login.path);\n\n            throw refreshTokenError;\n          } finally {\n            createRefreshTokenInterceptors();\n          }\n\n          return axiosAuthorized(error.response.config);\n        }\n\n        throw error;\n      },\n    );\n  };\n\n  useEffect(() => {\n    createRefreshTokenInterceptors();\n\n    return () => {\n      axiosAuthorized.interceptors.response.eject(refreshTokenResponseInterceptor.current);\n    };\n  }, []);\n\n  return children;\n});\n"],"mappings":"AAAA,OAASA,SAAS,CAAEC,MAAM,KAAQ,OAAO,CACzC,OAASC,QAAQ,KAAQ,YAAY,CACrC,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,MAAM,KAAQ,eAAe,CACtC,OAASC,eAAe,KAAQ,UAAU,CAC1C,MAAO,CAAAC,SAAS,KAAM,mBAAmB,CAMzC,MAAO,MAAM,CAAAC,oBAAoB,CAAGL,QAAQ,CAACM,IAAA,EAA6C,IAA5C,CAAEC,QAAoC,CAAC,CAAAD,IAAA,CACnF,KAAM,CAAAE,+BAA+B,CAAGT,MAAM,CAAC,CAAC,CAAC,CACjD,KAAM,CAAAU,QAAQ,CAAGR,WAAW,CAAC,CAAC,CAE9B,KAAM,CAAAS,8BAA8B,CAAGA,CAAA,GAAM,CAC3CF,+BAA+B,CAACG,OAAO,CAAGR,eAAe,CAACS,YAAY,CAACC,QAAQ,CAACC,GAAG,CAChFD,QAAQ,EAAKA,QAAQ,CACtB,KAAO,CAAAE,KAAK,EAAK,CACf,GAAIA,KAAK,CAACF,QAAQ,CAACG,MAAM,GAAK,GAAG,CAAE,CACjCD,KAAK,CAACF,QAAQ,CAACI,MAAM,CAACC,MAAM,CAAG,IAAI,CACnCf,eAAe,CAACS,YAAY,CAACC,QAAQ,CAACM,KAAK,CAACX,+BAA+B,CAACG,OAAO,CAAC,CAEpF,GAAI,CACF,KAAM,CAAAR,eAAe,CAACiB,IAAI,CAAC,qBAAqB,CAAC,CACnD,CAAE,MAAOC,iBAAiB,CAAE,CAC1BjB,SAAS,CAACkB,OAAO,CAACC,SAAS,CAAC,CAC5Bd,QAAQ,CAACP,MAAM,CAACsB,KAAK,CAACC,IAAI,CAAC,CAE3B,KAAM,CAAAJ,iBAAiB,CACzB,CAAC,OAAS,CACRX,8BAA8B,CAAC,CAAC,CAClC,CAEA,MAAO,CAAAP,eAAe,CAACY,KAAK,CAACF,QAAQ,CAACI,MAAM,CAAC,CAC/C,CAEA,KAAM,CAAAF,KAAK,CACb,CACF,CAAC,CACH,CAAC,CAEDjB,SAAS,CAAC,IAAM,CACdY,8BAA8B,CAAC,CAAC,CAEhC,MAAO,IAAM,CACXP,eAAe,CAACS,YAAY,CAACC,QAAQ,CAACM,KAAK,CAACX,+BAA+B,CAACG,OAAO,CAAC,CACtF,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,MAAO,CAAAJ,QAAQ,CACjB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}