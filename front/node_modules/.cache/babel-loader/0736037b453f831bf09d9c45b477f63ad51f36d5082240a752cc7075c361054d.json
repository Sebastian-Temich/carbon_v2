{"ast":null,"code":"import{useEffect,useRef}from'react';import{observer}from'mobx-react';import{axiosAuthorized,axiosPublic}from'@api/api';import{useTranslation}from'react-i18next';import{toast}from'react-toastify';export const ErrorHandlerProvider=observer(_ref=>{let{children}=_ref;const errorHandlerResponseInterceptorAuthorized=useRef(0);const errorHandlerResponseInterceptorPublic=useRef(0);const{t}=useTranslation();const errorHandlerInterceptor=async error=>{var _error$response;const statusCode=error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status;if(!statusCode)throw error;if(statusCode===422){toast.error(t('toast.formDataInvalidMessage'));}else if(statusCode>=400&&statusCode<500){var _error$response2,_error$response2$data;const errorDescription=error===null||error===void 0?void 0:(_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.description;showToastForGeneralApiError(errorDescription);}else if(statusCode>=500&&statusCode<600){toast.error(t('toast.internalServerError'));}else{toast.error(t('toast.unknownErrorMessage'));}throw error;};const createErrorHandlerInterceptors=()=>{errorHandlerResponseInterceptorAuthorized.current=axiosAuthorized.interceptors.response.use(response=>response,errorHandlerInterceptor);errorHandlerResponseInterceptorPublic.current=axiosPublic.interceptors.response.use(response=>response,errorHandlerInterceptor);};const showToastForGeneralApiError=errorDescription=>{if(!errorDescription){toast.error(t('toast.unknownErrorMessage'));}else{toast.error(t(\"apiErrors.\".concat(errorDescription)));}};useEffect(()=>{createErrorHandlerInterceptors();return()=>{axiosAuthorized.interceptors.response.eject(errorHandlerResponseInterceptorAuthorized.current);axiosPublic.interceptors.response.eject(errorHandlerResponseInterceptorPublic.current);};},[]);return children;});","map":{"version":3,"names":["useEffect","useRef","observer","axiosAuthorized","axiosPublic","useTranslation","toast","ErrorHandlerProvider","_ref","children","errorHandlerResponseInterceptorAuthorized","errorHandlerResponseInterceptorPublic","t","errorHandlerInterceptor","error","_error$response","statusCode","response","status","_error$response2","_error$response2$data","errorDescription","data","description","showToastForGeneralApiError","createErrorHandlerInterceptors","current","interceptors","use","concat","eject"],"sources":["/Users/st/Documents/carbon/front/src/components/error-handler-provider/error-handler-provider.tsx"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { observer } from 'mobx-react';\nimport { AxiosError } from 'axios';\nimport { axiosAuthorized, axiosPublic } from '@api/api';\nimport { useTranslation } from 'react-i18next';\nimport { toast } from 'react-toastify';\n\ninterface ErrorHandlerProviderProps {\n  children: JSX.Element;\n}\n\ninterface AxiosErrorBody {\n  description?: string;\n}\n\nexport const ErrorHandlerProvider = observer(({ children }: ErrorHandlerProviderProps) => {\n  const errorHandlerResponseInterceptorAuthorized = useRef(0);\n  const errorHandlerResponseInterceptorPublic = useRef(0);\n\n  const { t } = useTranslation();\n\n  const errorHandlerInterceptor = async (error: AxiosError<AxiosErrorBody>) => {\n    const statusCode = error?.response?.status;\n\n    if (!statusCode) throw error;\n\n    if (statusCode === 422) {\n      toast.error(t('toast.formDataInvalidMessage'));\n    } else if (statusCode >= 400 && statusCode < 500) {\n      const errorDescription = error?.response?.data?.description;\n      showToastForGeneralApiError(errorDescription);\n    } else if (statusCode >= 500 && statusCode < 600) {\n      toast.error(t('toast.internalServerError'));\n    } else {\n      toast.error(t('toast.unknownErrorMessage'));\n    }\n\n    throw error;\n  };\n\n  const createErrorHandlerInterceptors = () => {\n    errorHandlerResponseInterceptorAuthorized.current = axiosAuthorized.interceptors.response.use(\n      (response) => response,\n      errorHandlerInterceptor,\n    );\n    errorHandlerResponseInterceptorPublic.current = axiosPublic.interceptors.response.use(\n      (response) => response,\n      errorHandlerInterceptor,\n    );\n  };\n\n  const showToastForGeneralApiError = (errorDescription: string | undefined) => {\n    if (!errorDescription) {\n      toast.error(t('toast.unknownErrorMessage'));\n    } else {\n      toast.error(t(`apiErrors.${errorDescription}`));\n    }\n  };\n\n  useEffect(() => {\n    createErrorHandlerInterceptors();\n\n    return () => {\n      axiosAuthorized.interceptors.response.eject(\n        errorHandlerResponseInterceptorAuthorized.current,\n      );\n      axiosPublic.interceptors.response.eject(errorHandlerResponseInterceptorPublic.current);\n    };\n  }, []);\n\n  return children;\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}